<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="menu.js"></script>
</head>
<body class="centered-text">
    <div id="loader-bar"></div>
    <div id="title-bar"
         class="full-width">
        <div id="app-menu"
             class="dark-bg">
            <span>building the context navigation..</span>
        </div>
        <div id="context-menu"
             class="light-bg">
            <span>building the intra-context navigation...</span>
        </div>
    </div>
    <div id="content-window">
        <button onclick="menu.show()">Show Menu</button>
        <button onclick="menu.hide()">Hide Menu</button>
        <button onclick="menu.topNavigation()">App Menu</button>
        <button onclick="menu.contextNavigation()">Context Menu</button>

        <input name="expectedTime" type="number" id="myInput" oninput="loaderBar.waitFor(parseInt(this.value))" value="5000">
        <button onclick="loaderBar.waitFor(5000)">Start Loader</button>
        <button onclick="loaderBar.stop()">Stop Loader</button>


    </div>

    <script>
        var
                $bar = function(){return $("#loader-bar")},
                setWidth = function ($e, width, duration) {
                    return $e.animate({
                        width: width,
                    }, duration).promise();
                },
                LoaderBar = function($bar){
                                this.$bar = $bar;
                                this.updateTime = 450;
                            };
        LoaderBar.prototype.waitFor = function(expectedTime){
            this.expectedTime = expectedTime;
            this.timeLeft     = expectedTime;
            var self = this;
            if (this.timer) {
                clearInterval(this.timer);
            }
            self.$bar.width(0);
            this.timer = setInterval(
                    function () {
                        self.update();
                    }, this.updateTime);

            setTimeout(function(){
                self.$bar.show();
            }, this.updateTime);
        };


        LoaderBar.prototype.update = function(){
            this.timeLeft -=  this.updateTime;
            if(this.timeLeft < 0){
                this.timeLeft = (this.expectedTime/1.1);
            }
            var maxWidth = $(window).width(),
                percentageTimepassed = (this.timeLeft * 1.0)/this.expectedTime,
                currentWidth  = maxWidth - (maxWidth * percentageTimepassed);
            console.log(percentageTimepassed);
            setWidth(this.$bar, currentWidth, this.updateTime);
        };

        LoaderBar.prototype.stop = function(){
            clearInterval(this.timer);
            setWidth(
                    this.$bar,
                    $(window).width(),
                    this.updateTime);
            var self = this;
            setTimeout(function(){
                self.$bar.hide();
                self.$bar.width(0);
            }, 500);

        };
        $(window).load(function () {
            window.menu = new Menu($("#title-bar"), $("#app-menu"), $("#context-menu"))
            window.loaderBar = new LoaderBar($bar());
        });
    </script>
</body>
</html>
