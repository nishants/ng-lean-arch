<!DOCTYPE html>
<html lang="en">
<head>
    <!--<link rel="icon" href="favicon.gif" type="image/gif" >-->
    <link rel="icon" type="image/x-icon" sizes="8x8" href="data:image/x-icon;base64,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"  />

    <link href="style/index.css" rel="stylesheet" >
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="../../lib/ace/ace.js"></script>
    <script src="../../lib/ace/theme-monokai.js"></script>
    <script src="../../lib/ace/mode-ruby.js"></script>
    <script src="../../lib/ace/ext-beautify.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>

    <meta charset="UTF-8">
    <title>amoeba social labs</title>
</head>
<style>

</style>
<body ng-app="ruby-for-qa" ng-controller="editorController">

<div id="top-bar">
    <div id="section-name">ruby for qa &gt; exercise-one</div>
</div>
<div class="main-container">
    <div class="editor-view">
        <div id="editor"></div>
    </div>
</div>

<div class="console"
     ng-class="{'show' : editor.console.show}">
    <div class="title">
        <div class="status">
            Success <span>{{editor.console.output.scenarios | passingCount}}/{{editor.console.output.scenarios.length}}</span>
        </div>
        <div class="run">
            <a class="btn btn-success" ng-click="editor.run()">run</a>
        </div>
    </div>

    <pre class="output">
        <ul class="scenarios">
            <li ng-repeat="scenario in editor.console.output.scenarios">
                {{scenario.success ? "Success" : "Failed"}} | {{scenario.name}} | {{scenario.expected}} == {{scenario.actual}}
            </li>
        </ul>

    </pre>
</div>

<script>

    var app = angular.module("ruby-for-qa", []);
    app.value("compileServers",[{
        name: "default",
        url: "http://amoeba-social-rubylab.herokuapp.com"
    }]);
    app.config(function($httpProvider) {
        //Enable cross domain calls
        $httpProvider.defaults.useXDomain = true;

        //Remove the header containing XMLHttpRequest used to identify ajax call
        //that would prevent CORS from working
        $httpProvider.defaults.headers.common = {};
        $httpProvider.defaults.headers.post = {};
        $httpProvider.defaults.headers.put = {};
        $httpProvider.defaults.headers.patch = {};
        $httpProvider.defaults.headers.options = {};
    });

    app.filter("passingCount", [ function(){
        return function(scenarios){
            return !scenarios ? 0 : scenarios.filter(function(scenario){
                return scenario.success;
            }).length;
        };
    }]);
    app.service("taskService", ["$http", "compileServers", function($http, compileServers){
        var remote = compileServers[0];

        return {
            getAssignment : function(id){
                return $http.get(remote.url+"/tasks/:id/worksheet".replace(":id", id)).then(function(response){
                    return response.data;
                })
            },
            evaluateAssignment : function(taskId, solutionText){
                return $http.put(remote.url+"/tasks/:id/evaluate".replace(":id", taskId), solutionText).then(function(response){
                    return response.data;
                })
            }
        }
    }]);
    app.controller("editorController", ["$scope", "taskService", function($scope, taskService){
        var editor = {
                content: null,
                console  : {
                    show: false,
                },
                ace: ace.edit("editor"),
                run: function(){
                    taskService.evaluateAssignment("exercise-one", editor.ace.getValue()).then(function(result){
                        editor.console.output = result;
                        editor.console.show = true;
                    });
                }
            };

        taskService.getAssignment("exercise-one").then(function(worksheet){
            editor.ace.setValue(worksheet);
            editor.run();
        });

//        editor.ace.setTheme("ace/theme/monokai");
        editor.ace.getSession().setMode("ace/mode/ruby");
        editor.ace.getSession().setMode("ace/mode/ruby");
        $scope.editor = editor;
    }]);
</script>
</body>
</html>