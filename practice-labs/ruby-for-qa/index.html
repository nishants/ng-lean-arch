<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="../favicon.gif" type="image/gif" sizes="16x16">

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="../../lib/ace/ace.js"></script>
    <script src="../../lib/ace/theme-monokai.js"></script>
    <script src="../../lib/ace/mode-ruby.js"></script>
    <script src="../../lib/ace/ext-beautify.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>

    <meta charset="UTF-8">
    <title>amoeba social labs</title>
</head>
<style>
    #editor {
        /** Setting height is also important, otherwise editor wont showup**/
        height: calc(100vh - 60px);
        width: 100%;
    }
    #top-bar{
        height: 30px;
        line-height: 30px;
        padding-left: 10px;
        width: 100%;
    }
    #run-button > a{
        width: 200px;
    }
    #run-button{
        float: right;
        padding: 5px 10px;
    }
    #section-name{
        display: inline-block;
        line-height: 30px;
    }
</style>
<body ng-app="ruby-for-qa">

<div id="top-bar">
    <div id="section-name">Exercise One</div>
    <div id="run-button"><a class="btn btn-default">run</a></div>
</div>
<div class="main-container">
    <div class="editor-view" ng-controller="editorController">
        <pre id="editor"></pre>
    </div>
</div>

<script>

    var app = angular.module("ruby-for-qa", []);
    app.value("compileServers",[{
        name: "default",
        url: "http://amoeba-social-rubylab.herokuapp.com"
    }]);
    app.config(function($httpProvider) {
        //Enable cross domain calls
        $httpProvider.defaults.useXDomain = true;

        //Remove the header containing XMLHttpRequest used to identify ajax call
        //that would prevent CORS from working
        delete $httpProvider.defaults.headers.common['X-Requested-With'];
    });

    app.service("taskService", ["$http", "compileServers", function($http, compileServers){
        var remote = compileServers[0];

        return {
            getAssignment : function(id){
                return $http.get(remote.url+"/task/:id/worksheet".replace(":id", id)).then(function(response){
                    return response.data;
                })
            }
        }
    }]);
    app.controller("editorController", ["$scope", "taskService", "compileServers", function($scope, taskService, compileServers){
        var editor = {
                content: null,
                ace: ace.edit("editor")
            };

        taskService.getAssignment("exercise-one").then(function(worksheet){
            editor.ace.setValue(worksheet);
        });

        editor.ace.setTheme("ace/theme/monokai");
        editor.ace.getSession().setMode("ace/mode/ruby");
        editor.ace.getSession().setMode("ace/mode/ruby");
    }]);
</script>
</body>
</html>