<!DOCTYPE html>
<html>

<head>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../lib/normalize-3.0.2.css">
    <link rel="stylesheet" href="../../lib/font-awesome-4.5.0/css/font-awesome.min.css">
    <style>

        .map > svg{
            width: 600px;
        }
    </style>

</head>

<body ng-app="world-traverl" ng-controller="MapController">
    <div class  = "map"
         onload = "map.load()"
         ng-include="'images/map.svg'"></div>

<script src="../../lib/Snap.svg-0.4.1/dist/snap.svg-min.js"></script>
<script src="../../lib/jquery-2.1.4.min.js"></script>
<script src="../../lib/angular-1.4.3.js"></script>
<script>

    var countriesToInitialize = [
        { code: "in", name: "India"      ,position: "scale(5) translateY(50px) translateX(150px)"},
        { code: "es", name: "Spain"      ,position: "scale(5) translateY(50px) translateX(90px)"},
        { code: "ae", name: "UAE"        ,position: "scale(5) translateY(50px) translateX(90px)"},
        { code: "bt", name: "Bhutan"     ,position: "scale(5) translateY(50px) translateX(90px)"},
        { code: "gr", name: "Greece"     ,position: "scale(5) translateY(50px) translateX(90px)"},
        { code: "ph", name: "Philippines",position: "scale(5) translateY(50px) translateX(90px)"}
    ];
    var Country = function(map, country){
        var isoCode = country.code;
        var selector = "." + isoCode + ".land",
            coast = map.find(selector),
            inland = coast.find(selector);

        this.land =  inland.length ? inland : coast;
        this.position = country.position;
        var self = this;
        this.land.on("click", function(){
            self.highlight();
        });
    };

    Country.prototype.highlight = function(){
        this.land.css("fill", "red");
        this.land.children().css("fill", "red");//required of island countries like Philllipines
    };

    var Map = function($map, $wrapper){
        this.$map = $map;
        var countries = {};
        countriesToInitialize.forEach(function(country){
            countries[country.code] = new Country($map, country);
        });
        this.countries = countries;
        this.$wrapper = $wrapper;
    };

    Map.prototype.findCountry = function(isoCode){
        var country = this.countries[isoCode];
        this.$wrapper.css("transform", country.position);
        country.highlight();
        return country;
    };

    var app = angular.module("world-traverl",[]);
    app.controller("MapController", function($scope){
       $scope.map = {
           map: null,
           ready: false,
           findCountry: function(code){
               return this.map.findCountry(code);
           },
           load: function(){
               this.map = new Map($(".map > svg").first(), $(".map").first());
               this.ready = true;
           }
       };
        window.map = $scope.map;
    });

</script>
</body>
</html>
