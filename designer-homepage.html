<!DOCTYPE html>
<html>

<head>
    <script src="lib/angular.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
    <style>
        body{
            background-color: grey;
        }
        #top-bar{
            background-color: rgba(0, 0,0, 0.5);
            position: fixed;
            top: 0;
            width: 100%;
        }
        #top-bar + .title-bar-pad{
            height: 70px;
            background-color: rgba(0, 0,0, 0.8);
        }
        #navigation-bar{
        }
        #show-menu{
            position: fixed;
            top: 0;
            right: 0;
            font-size: 60px;
            color: rgba(233, 233, 233, 1);
            margin: 15px;
            display: inline-block;
            font-weight: 600;
            line-height: 70px;
        }
        #navigation-bar > .section-link{
            font-family: 'Raleway', sans-serif;
        }
        #navigation-bar > span{
            height: 70px;
            padding-bottom: 20px;
            display: inline-block;
            min-width: 100px;

            color: rgba(233, 233, 233, 1);
            font-weight: 600;
            line-height: 50px;
        }
        .txt-centered{
            text-align: center;
        }
        body{
        }
        .page{
            min-height: 70vh;
            font-size: 30px;
            font-family: 'Raleway', sans-serif;

            -webkit-transition: all 100ms cubic-bezier(0.42, 0, 0.58, 1);
            -moz-transition: all 100ms cubic-bezier(0.42, 0, 0.58, 1);
            -o-transition: all 100ms cubic-bezier(0.42, 0, 0.58, 1);
            transition: all 100ms cubic-bezier(0.42, 0, 0.58, 1);
        }
        .page *{
            margin: 15px;
        }
        .one.page{
            background-color: white;
        }
        .two.page{
            background-color: rgba(200, 200, 200, 0.2);
        }
        .three.page{
            min-height:40vh;
        }
        .four.page{
            background-color: rgba(200, 200, 200, 0.2);
        }
        .page.above{
            transform: rotateY(-90deg);
            opacity: 0;
        }
        .page.below{
            transform: rotateY(90deg);
            opacity: 0;
        }
        .page.highlight{
        }
        .page.blue{
            background-color: #34495e;
            color: #e4e6e5;
        }
        .page.orange{
            background-color: #f39c12;
        }
        .page.green{
            background-color: #5FB59A;
        }
        #navigation-bar > .close{
            display: none;
        }
        @media screen and (max-width: 900px) {
            #navigation-bar > .close{
                position: fixed;
                top: 0;
                right: 0;
                font-size: 40px;
                color: rgba(233, 233, 233, 1);
                margin: 15px;
                display: inline-block;
                font-weight: 600;
                line-height: 70px;
                opacity: 1;
            }

            #navigation-bar {
                padding-top: 50px;
            }
            #navigation-bar > .section-link{
                display: block;
                font-size: 30px;
            }
            #top-bar{
                background-color: rgba(0, 0,0, 0.8);
            }
            #top-bar + .title-bar-pad{
                display: none
            }
        }

    </style>
</head>

<body class="txt-centered" ng-app="scroll-demo" ng-controller="HomePage">
<nav>
    <span id="show-menu"
          class="menu-button glyphicon glyphicon-menu-hamburger"
          ng-show="!__showMenuBar"
          ng-click="__showMenuBar = true"></span>
    <div id="top-bar">
        <div id="navigation-bar" ng-show="__showMenuBar">
            <span class="close glyphicon glyphicon-remove" ng-click="__showMenuBar = false"></span>
            <span class="section-link">Home</span>
            <span class="section-link">Tutorials</span>
            <span class="section-link">Widgets</span>
            <span class="section-link">About Me</span>
        </div>
    </div>
    <div class="title-bar-pad"></div>
</nav>
<article class="contents">
    <section class="page blue"
             ng-include="'rob-the-robes/home.html'"></section>

    <section class="page two green"></section>

    <section class="page three orange"
             scroll-listener="app.pageThree.scroll"
             ng-class="{'above' : app.pageThree.scroll.state.aboveViewport,'highlight' : app.pageThree.scroll.state.inViewport, 'below': app.pageThree.scroll.state.belowViewport}"
             ng-include="'html-with-content.html'"
             style="opacity: {{opacityAt(app.pageThree.scroll.state)}};"></section>

    <section class="page four blue" ></section>
    <section class="page green" ></section>
</article>

<script>
    var app = angular.module("scroll-demo", []);
    app.controller("HomePage", ["$scope", function($scope){
        $scope.Math = window.Math;
        $scope.opacityAt = function(offset){
            var dissolve = Math.abs(app.pageThree.scroll.state.offset) < 0.2;
            return dissolve ? Math.abs(app.pageThree.scroll.state.offset) :1;
        };
        $scope.app = {pageFour: {},pageThree: {}};
        window.app = $scope.app;
    }]);



    app.service("PageStates", [function(){
        var InViewport  = {
            name: "InViewport",
            watching: true,
            hidden: false,
            at: function(postion){
                return
            },
            invalidAt: function(position){
                return false;
            },
        }, BelowViewport  = {
            name: "BelowViewport",
            watching: false,
            hidden: true,
            at: function(position){
                var watching = position > -5 && position < 105;
                return watching ? InViewport: this;
            },
            invalidAt: function(position){
                return position > 0 && position < 100;
            },
        };
        return {
            BelowViewport: BelowViewport,
        }
    }]);
    app.service("ScrollEvent", ['PageStates',function(PageStates){
        var viewportBottom  = function(){return window.pageYOffset},
            viewportTop     = function(){return window.pageYOffset - $(window).height()},
            elementTop      = function($e){return ($e.offset().top - $e.height())},
            elementBottom   = function($e){return elementTop($e) + $e.height()},
           viewablePartOf = function ($e) {
            var viewportBottom      = window.pageYOffset,
                    elementTop      = ($e.offset().top - $e.height()),
                    elementHeight   = $e.height(),
                    percentViewed   =  (viewportBottom - elementTop)/elementHeight * 100;

            return percentViewed;
        };

        var ScrollEventListener = {
            elements: [],
            listen: function (element) {
                var target = {
                    $e: $(element),
                    scrolledBy: 0,
                    state: PageStates.BelowViewport,
                    update: function(){
                        this.scrolledBy = viewablePartOf(this.$e);
                        var container = (this.$e)[0].getBoundingClientRect(),
                            aboveViewport = (container.top  + container.height) < 0 ,
                            belowViewport = container.top > $(window).height(),
                            inViewport    = !aboveViewport && !belowViewport,
                            offset        = container.top > 0 ? (container.height - container.top)/container.height: -(container.height + container.top)/container.height;
                        this.state = {
                            aboveViewport   : aboveViewport,
                            inViewport      : inViewport,
                            belowViewport   : belowViewport,
                            offset         : offset
                        };

                    }
                };
                this.elements.push(target);
                return target;
            },
        };
        return ScrollEventListener;
    }])

    app.directive("scrollListener", ['$parse', 'ScrollEvent', function($parse, ScrollEvent){
        return {
            transclude: false,
            scope:false,
            restrict: 'A',
            link: function(scope, element, attrs){
                var scrollListener = $parse(attrs.scrollListener);
                var listener = ScrollEvent.listen(element);
                scrollListener.assign(scope, listener);
                angular.element(window).bind("DOMContentLoaded load resize scroll",function(){
                    scope.$apply(function(){
                        listener.update();
                    });
                })
            }
        }
    }]);
</script>
</body>
</html>
