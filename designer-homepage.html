<!DOCTYPE html>
<html>

<head>
    <script src="lib/angular.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

    <link rel="stylesheet" type="text/css" href="lib/bootstrap.min.css">
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
    <style>
        #top-bar{
            background-color: rgba(0, 0,0, 0.5);
            position: fixed;
            top: 0;
            width: 100%;
        }
        #top-bar + .title-bar-pad{
            height: 70px;
            background-color: rgba(0, 0,0, 0.8);
        }
        #navigation-bar{
        }
        #navigation-bar > span{
            height: 70px;
            padding-bottom: 20px;
            display: inline-block;
            min-width: 100px;

            color: rgba(233, 233, 233, 1);
            font-weight: 600;
            line-height: 50px;
            font-family: 'Raleway', sans-serif;
        }
        .txt-centered{
            text-align: center;
        }
        body{
            height: 10vh;
        }
        .page{
            min-height: 100vh;
            -webkit-transition: all 100ms cubic-bezier(0.42, 0, 0.58, 1);
            -moz-transition: all 100ms cubic-bezier(0.42, 0, 0.58, 1);
            -o-transition: all 100ms cubic-bezier(0.42, 0, 0.58, 1);
            transition: all 100ms cubic-bezier(0.42, 0, 0.58, 1);
        }
        .one.page{
            background-color: white;
        }
        .two.page{
            background-color: rgba(200, 200, 200, 0.2);
        }
        .three.page{
            background-color: #272822;
        }
        .four.page{
            background-color: rgba(200, 200, 200, 0.2);
        }
        .in-view:after{
            content: "I am bing viewed"
        }
        .hide{
            opacity: 0.1;
        }
        .watching{

        }
        .bye-bye{

        }
        .born{

        }
    </style>
</head>

<body class="txt-centered" ng-app="scroll-demo" ng-controller="HomePage">
<div id="top-bar">
    <div id="navigation-bar">
        <span>Home</span>
        <span>Tutorials</span>
        <span>Widgets</span>
        <span>About Me</span>
    </div>
</div>
<div class="title-bar-pad"></div>
<div class="page one"  ></div>
<div class="page two"   ></div>
<div class="page three"
     scroll-listener="app.pageThree.scroll"
     ng-class="{'hide' : app.pageThree.scroll.scrolledBy <= 0, 'watching' : app.pageThree.scroll.scrolledBy >= 33.33 , 'bye-bye' : app.pageThree.scroll.scrolledBy >= 95, 'born' : app.pageThree.scroll.scrolledBy >= 5}">
    {{app.pageThree.scroll.scrolledBy >= 33.33 ? "Welcome" : ""}}
    {{app.pageThree.scroll.scrolledBy >= 0 ?     "I am in" : ""}}
    {{app.pageThree.scroll.scrolledBy >= 66.66 ? "One last time" : ""}}
    {{app.pageThree.scroll.scrolledBy >= 95 ?   "Bye bye" : ""}}

</div>
<div class="page four"
     scroll-listener="app.pageFour.scroll"
     ng-class="{'in-view' : (app.pageFour.scroll.scrolledBy >= 33.33)}">
    {{app.pageFour.scroll.scrolledBy}}
</div>

<script>
    var app = angular.module("scroll-demo", []);
    app.controller("HomePage", ["$scope", function($scope){
        $scope.app = {pageFour: {},pageThree: {}};
        window.app = $scope.app;
    }]);

    app.service("ScrollEvent", ['$window', function($window){
        var viewablePartOf = function ($e) {
            var viewportBottom      = $window.pageYOffset,
                    elementTop      = ($e.offset().top - $e.height()),
                    elementHeight   = $e.height(),
                    percentViewed   =  (viewportBottom - elementTop)/elementHeight * 100;

            return percentViewed;
        };

        var ScrollEventListener = {
            elements: [],
            listen: function (element) {
                var target = {
                    $e: $(element),
                    scrolledBy: 33.33,
                    update: function(){
                        return this.scrolledBy = viewablePartOf(this.$e);
                    }

                };
                this.elements.push(target);
                return target;
            },
        };
        return ScrollEventListener;
    }])

    app.directive("scrollListener", ['$parse', 'ScrollEvent', function($parse, ScrollEvent){
        return {
            transclude: false,
            scope:false,
            restrict: 'A',
            link: function(scope, element, attrs){
                var scrollListener = $parse(attrs.scrollListener);
                var listener = ScrollEvent.listen(element);
                scrollListener.assign(scope, listener);
                angular.element(window).bind("scroll",function(){
                    scope.$apply(function(){
                        listener.update();
                    });
                })
            }
        }
    }]);
</script>
</body>
</html>
